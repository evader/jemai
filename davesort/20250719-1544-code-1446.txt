\n#!/bin/bash\nset -e\n\necho \"===== JEMAI NUKE & FIX: Ollama + Open WebUI Reset =====\"\n\n# ---- 1. STOP & REMOVE ALL OLLAMA/OPEN WEBUI CONTAINERS ----\necho \"[1/6] Stopping & removing ALL Ollama containers...\"\ndocker ps -a --filter \"ancestor=ollama/ollama:latest\" -q | xargs -r docker rm -f || true\ndocker ps -a --filter \"name=ollama\" -q | xargs -r docker rm -f || true\n\necho \"[2/6] Stopping & removing ALL Open WebUI containers...\"\ndocker ps -a --filter \"ancestor=ghcr.io/open-webui/open-webui:main\" -q | xargs -r docker rm -f || true\ndocker ps -a --filter \"name=open-webui\" -q | xargs -r docker rm -f || true\ndocker ps -a --filter \"name=jemai_prod_open_webui\" -q | xargs -r docker rm -f || true\n\n# ---- 2. REMOVE DUPLICATE/OLD DOCKER VOLUMES (except canonical) ----\necho \"[3/6] Removing duplicate ollama/openwebui volumes...\"\ndupes=$(docker volume ls -q | grep -E 'ollama|openwebui' | grep -v -E '^ollama$|^openwebui_data$')\nfor v in $dupes; do\n  docker volume rm \"$v\" || true\ndone\n\n# ---- 3. COPY ALL MODELS INTO CANONICAL OLLAMA VOLUME ----\nOLLAMA_TARGET=\"/var/lib/docker/volumes/ollama/_data\"\nsudo mkdir -p \"$OLLAMA_TARGET\"\nsudo chmod 777 \"$OLLAMA_TARGET\"\nfor v in $(docker volume ls -q | grep ollama | grep -v '^ollama$'); do\n  src=\"/var/lib/docker/volumes/${v}/_data\"\n  if [ -d \"$src\" ]; then\n    echo \"[INFO] Copying models from $src ...\"\n    sudo cp -ar \"$src/.\" \"$OLLAMA_TARGET/\" || true\n  fi\ndone\n\n# ---- 4. REMOVE & RECREATE Open WebUI DATA VOLUME ----\ndocker volume rm openwebui_data || true\ndocker volume create openwebui_data\n\n# ---- 5. RUN OLLAMA + OPEN WEBUI FRESH ----\necho \"[4/6] Starting fresh Ollama container...\"\ndocker run -d \\\n  --name ollama \\\n  --restart always \\\n  -p 11434:11434 \\\n  -v ollama:/root/.ollama \\\n  ollama/ollama:latest\n\necho \"[5/6] Starting fresh Open WebUI container...\"\ndocker run -d \\\n  --name open-webui \\\n  --restart always \\\n  -p 8080:8080 \\\n  -v openwebui_data:/app/backend/data \\\n  ghcr.io/open-webui/open-webui:main\n\n# ---- 6. WAIT A BIT THEN CONFIGURE ADMIN USER ----\nsleep 5\ncat <<'JEMCONF' | sudo tee /var/lib/docker/volumes/openwebui_data/_data/config.json > /dev/null\n{\n  \"users\": [\n    {\n      \"email\": \"daveleepersonal@gmail.com\",\n      \"password\": \"techno\",\n      \"role\": \"admin\",\n      \"active\": true\n    }\n  ],\n  \"settings\": {\n    \"model\": \"llama3\",\n    \"allowLogs\": true,\n    \"adminOpen\": true\n  }\n}\nJEMCONF\nsudo chmod 600 /var/lib/docker/volumes/openwebui_data/_data/config.json\nsudo docker restart open-webui\n\necho \"===== ALL CLEAN. Visit http://localhost:8080/ (login: daveleepersonal@gmail.com / techno) =====\"\n